{"ast":null,"code":"import store from \"../redux/store\";\nexport const ZOMBIE_COUNT = \"ZOMBIE_COUNT\"; // action type\n// action creator (dispatch sends this to redux reducer)\n\nfunction zombieCount(data) {\n  return {\n    type: ZOMBIE_COUNT,\n    payload: data\n  };\n} //\n//  set up the blockchain shadow contract, user address, and user zombie count.  Put into redux store.\n//\n\n\nasync function getZombieCount(CZ, userAddress) {\n  // get number of zombies owned by the user account\n  let userZombieCount = +(await CZ.balanceOf(userAddress)); // + convert a string to an integer\n  // do a binary search to estimate total zombie count.\n  // It is a real shame that the Cryptozombies contract doesn't totally comply with ERC720 to include a function\n  // that returns totalZombieount.\n\n  var high = 8192;\n  var low = 0;\n  var middle = 4096;\n\n  while (low < high) {\n    try {\n      await CZ.zombies(middle);\n      low = middle + 1;\n      middle = Math.floor(low + (high - low) / 2);\n    } catch {\n      high = middle - 1;\n      middle = Math.floor(low + (high - low) / 2);\n    }\n  } // put state data into the REDUX store for easy access from other pages and components\n\n\n  let data = {\n    totalZombieCount: Math.max(low - 1, 1),\n    // from binary search\n    userZombieCount //EC7 shorthand for totalZombieCount:totalZombieCount because of same variable name\n\n  };\n  store.dispatch(zombieCount(data));\n}\n\nexport default getZombieCount;","map":{"version":3,"sources":["/Users/jgersch/CSU Classes/CS458 Spring 2021/Projects/CryptoZombiesGame2021/zombiedapp/src/utils/getZombieCount.js"],"names":["store","ZOMBIE_COUNT","zombieCount","data","type","payload","getZombieCount","CZ","userAddress","userZombieCount","balanceOf","high","low","middle","zombies","Math","floor","totalZombieCount","max","dispatch"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,gBAAlB;AAEA,OAAO,MAAMC,YAAY,GAAG,cAArB,C,CAAqC;AAE5C;;AACA,SAASC,WAAT,CAAqBC,IAArB,EAA2B;AACzB,SAAO;AACLC,IAAAA,IAAI,EAAEH,YADD;AAELI,IAAAA,OAAO,EAAEF;AAFJ,GAAP;AAID,C,CAED;AACA;AACA;;;AAEA,eAAeG,cAAf,CAA8BC,EAA9B,EAAkCC,WAAlC,EAA+C;AAC7C;AACA,MAAIC,eAAe,GAAG,EAAE,MAAMF,EAAE,CAACG,SAAH,CAAaF,WAAb,CAAR,CAAtB,CAF6C,CAEc;AAE3D;AACA;AACA;;AAEA,MAAIG,IAAI,GAAG,IAAX;AACA,MAAIC,GAAG,GAAG,CAAV;AACA,MAAIC,MAAM,GAAG,IAAb;;AAEA,SAAOD,GAAG,GAAGD,IAAb,EAAmB;AACf,QAAI;AACJ,YAAMJ,EAAE,CAACO,OAAH,CAAWD,MAAX,CAAN;AACAD,MAAAA,GAAG,GAAGC,MAAM,GAAG,CAAf;AACAA,MAAAA,MAAM,GAAGE,IAAI,CAACC,KAAL,CAAWJ,GAAG,GAAG,CAACD,IAAI,GAAGC,GAAR,IAAe,CAAhC,CAAT;AACD,KAJC,CAIA,MAAM;AACND,MAAAA,IAAI,GAAGE,MAAM,GAAG,CAAhB;AACAA,MAAAA,MAAM,GAAGE,IAAI,CAACC,KAAL,CAAWJ,GAAG,GAAG,CAACD,IAAI,GAAGC,GAAR,IAAe,CAAhC,CAAT;AACD;AACF,GArB4C,CAuB7C;;;AAEA,MAAIT,IAAI,GAAG;AACTc,IAAAA,gBAAgB,EAAEF,IAAI,CAACG,GAAL,CAASN,GAAG,GAAC,CAAb,EAAgB,CAAhB,CADT;AAC+B;AACxCH,IAAAA,eAFS,CAEgB;;AAFhB,GAAX;AAKAT,EAAAA,KAAK,CAACmB,QAAN,CAAejB,WAAW,CAACC,IAAD,CAA1B;AACD;;AAED,eAAeG,cAAf","sourcesContent":["import store from \"../redux/store\";\n\nexport const ZOMBIE_COUNT = \"ZOMBIE_COUNT\"; // action type\n\n// action creator (dispatch sends this to redux reducer)\nfunction zombieCount(data) {\n  return {\n    type: ZOMBIE_COUNT,\n    payload: data\n  };\n}\n\n//\n//  set up the blockchain shadow contract, user address, and user zombie count.  Put into redux store.\n//\n\nasync function getZombieCount(CZ, userAddress) {\n  // get number of zombies owned by the user account\n  let userZombieCount = +(await CZ.balanceOf(userAddress));  // + convert a string to an integer\n\n  // do a binary search to estimate total zombie count.\n  // It is a real shame that the Cryptozombies contract doesn't totally comply with ERC720 to include a function\n  // that returns totalZombieount.\n\n  var high = 8192;\n  var low = 0;\n  var middle = 4096;\n\n  while (low < high) {\n      try {\n      await CZ.zombies(middle);\n      low = middle + 1;\n      middle = Math.floor(low + (high - low) / 2);\n    } catch {\n      high = middle - 1;\n      middle = Math.floor(low + (high - low) / 2);\n    }\n  }\n\n  // put state data into the REDUX store for easy access from other pages and components\n\n  let data = {\n    totalZombieCount: Math.max(low-1, 1),   // from binary search\n    userZombieCount          //EC7 shorthand for totalZombieCount:totalZombieCount because of same variable name\n  };\n\n  store.dispatch(zombieCount(data));\n}\n\nexport default getZombieCount;\n"]},"metadata":{},"sourceType":"module"}